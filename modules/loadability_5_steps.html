<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5 Steps of Loadability ‚Äî Operational Terms</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../style_patch.css" />
  <script src="../common.js" defer></script>
  <style>
    .container { max-width: 1100px; margin: 0 auto; padding: 1rem; }
    .grid { display: grid; gap: 1rem; }
    .card { border: 1px solid #333; border-radius: 12px; padding: 1rem; background: #0e0e0e; }
    .muted { opacity: .85; font-size: .95rem; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: .5rem; }
    .btn { padding: .5rem .9rem; border-radius: 8px; border: 1px solid #444; cursor: pointer; background: #1a1a1a; }
    .btn:active { transform: translateY(1px); }
    .btn-primary { border-color: #3d8bfd; }
    .btn-danger { border-color: #cc3344; }
    .pill { padding: .25rem .5rem; border: 1px solid #444; border-radius: 999px; font-size: .8rem; }
    .progress { height: 10px; background: #222; border-radius: 999px; overflow: hidden; }
    .progress > div { height: 100%; background: #3d8bfd; width: 0; }
    .step-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem; }
    details summary { cursor: pointer; font-weight: 600; }
    textarea { width: 100%; min-height: 72px; background: #121212; color: #fff; border: 1px solid #333; border-radius: 8px; padding: .5rem; }
    label { display: flex; align-items: center; gap: .5rem; margin: .25rem 0; }
    .summary-box { white-space: pre-wrap; border: 1px dashed #444; padding: .75rem; border-radius: 8px; background: #121212; }
  </style>
</head>
<body>
  <button onclick="goHome()" class="home-button">üè† Home</button>
  <div class="container">
    <h1>5 Steps of Loadability</h1>
    <p class="muted">Operational wording per your printout. Check every item in a step to mark it <em>Complete</em>. Notes don‚Äôt affect completion.</p>

    <div class="row" style="margin: 1rem 0;">
      <div class="pill" id="progress-label">0/5 complete</div>
      <div class="progress" style="flex:1;">
        <div id="progress-bar"></div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="step-header">
          <h2>Step 1 ‚Äî Vehicle Projection Limit</h2>
          <span class="pill" id="s1-status">Incomplete</span>
        </div>
        <details open>
          <summary>Verify projection of vehicle geometry against aircraft limits</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s1.captureDims" /> Dimensions captured (L√óW√óH, overhangs, projections)</label>
            <label><input type="checkbox" data-key="s1.compareProj" /> Projection compared to aircraft envelope/limits</label>
            <label><input type="checkbox" data-key="s1.margins" /> Clearance margins documented</label>
            <label><input type="checkbox" data-key="s1.photos" /> Reference diagrams/photos attached</label>
            <label>Notes:</label>
            <textarea data-key="s1.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>

      <div class="card">
        <div class="step-header">
          <h2>Step 2 ‚Äî Ramp Toe Contact Limit</h2>
          <span class="pill" id="s2-status">Incomplete</span>
        </div>
        <details>
          <summary>Assess ramp toe contact per approach angle and vehicle geometry</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s2.approachAngle" /> Approach angle/geometry evaluated</label>
            <label><input type="checkbox" data-key="s2.contactCheck" /> Contact risk at ramp toe checked</label>
            <label><input type="checkbox" data-key="s2.shoring" /> Approach shoring considered/applied (if needed)</label>
            <label><input type="checkbox" data-key="s2.docs" /> Calculation/assumptions documented</label>
            <label>Notes:</label>
            <textarea data-key="s2.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>

      <div class="card">
        <div class="step-header">
          <h2>Step 3 ‚Äî Ground Contact Limit</h2>
          <span class="pill" id="s3-status">Incomplete</span>
        </div>
        <details>
          <summary>Confirm no ground strike during transition/ramp movement</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s3.clearance" /> Undercarriage/overhang clearances verified</label>
            <label><input type="checkbox" data-key="s3.path" /> Path/transition checked for strike points</label>
            <label><input type="checkbox" data-key="s3.sleeper" /> Sleeper or parking shoring planned if required</label>
            <label><input type="checkbox" data-key="s3.docs" /> Findings documented</label>
            <label>Notes:</label>
            <textarea data-key="s3.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>

      <div class="card">
        <div class="step-header">
          <h2>Step 4 ‚Äî Ramp Crest Limit</h2>
          <span class="pill" id="s4-status">Incomplete</span>
        </div>
        <details>
          <summary>Evaluate crest interference at ramp hinge/crest</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s4.geom" /> Crest geometry vs vehicle breakover checked</label>
            <label><input type="checkbox" data-key="s4.contact" /> Potential crest contact assessed</label>
            <label><input type="checkbox" data-key="s4.mitigation" /> Mitigation (shoring/technique) identified</label>
            <label><input type="checkbox" data-key="s4.docs" /> Calculation and rationale documented</label>
            <label>Notes:</label>
            <textarea data-key="s4.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>

      <div class="card">
        <div class="step-header">
          <h2>Step 5 ‚Äî Parking Overhang Limit</h2>
          <span class="pill" id="s5-status">Incomplete</span>
        </div>
        <details>
          <summary>Check overhang while parked (doors/rails/obstacles)</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s5.overhang" /> Overhang vs interior obstacles verified</label>
            <label><input type="checkbox" data-key="s5.egress" /> Egress/aisles/access maintained</label>
            <label><input type="checkbox" data-key="s5.secure" /> Chocks/parking shoring/restraint readiness</label>
            <label><input type="checkbox" data-key="s5.docs" /> Parking configuration documented</label>
            <label>Notes:</label>
            <textarea data-key="s5.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>
    </div>

    <div class="card" style="margin-top:1rem;">
      <div class="row">
        <h2>Summary</h2>
        <div class="row" style="gap:.5rem;">
          <button class="btn btn-primary" id="btn-generate">Generate Summary</button>
          <button class="btn" id="btn-export">Export JSON</button>
          <button class="btn" onclick="window.print()">Print</button>
          <button class="btn btn-danger" id="btn-reset">Reset</button>
        </div>
      </div>
      <div id="summary" class="summary-box" style="margin-top:.5rem;"></div>
    </div>
  </div>

  <script>
    (function(){
      const KEY = "lp_loadability5_ops";
      const hasLP = typeof window.LP !== "undefined";
      const saveJSON = hasLP && LP.saveJSON ? (k,v)=>LP.saveJSON(k,v) : (k,v)=>{ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} };
      const loadJSON = hasLP && LP.loadJSON ? (k,f)=>LP.loadJSON(k,f) : (k,f)=>{ try{ const raw=localStorage.getItem(k); return raw?JSON.parse(raw):f; }catch(e){ return f; } };

      function collect() {
        const inputs = document.querySelectorAll("[data-key]");
        const data = {};
        inputs.forEach(el => {
          const key = el.getAttribute("data-key");
          if (el.type === "checkbox") data[key] = !!el.checked;
          else data[key] = el.value || "";
        });
        return data;
      }

      function apply(data) {
        const inputs = document.querySelectorAll("[data-key]");
        inputs.forEach(el => {
          const key = el.getAttribute("data-key");
          if (!(key in data)) return;
          if (el.type === "checkbox") el.checked = !!data[key];
          else el.value = data[key];
        });
      }

      function save() { saveJSON(KEY, collect()); }
      function load() { return loadJSON(KEY, {}); }
      function reset() {
        localStorage.removeItem(KEY);
        document.querySelectorAll("[data-key]").forEach(el => {
          if (el.type === "checkbox") el.checked = false;
          else el.value = "";
        });
        updateStatus();
        document.getElementById("summary").textContent = "";
      }

      function stepComplete(prefix) {
        const boxes = Array.from(document.querySelectorAll(`input[type="checkbox"][data-key^="${prefix}."]`));
        if (boxes.length === 0) return false;
        return boxes.every(cb => cb.checked === true);
      }

      function updateStatus() {
        const steps = [1,2,3,4,5];
        let done = 0;
        steps.forEach(n => {
          const ok = stepComplete("s"+n);
          const pill = document.getElementById(`s${n}-status`);
          if (pill) pill.textContent = ok ? "Complete" : "Incomplete";
          if (pill) pill.style.borderColor = ok ? "#2aa84a" : "#444";
          if (ok) done++;
        });
        const pct = (done/steps.length)*100;
        document.getElementById("progress-label").textContent = `${done}/5 complete`;
        document.getElementById("progress-bar").style.width = `${pct}%`;
      }

      function summaryText() {
        const data = collect();
        function line(ok){ return ok ? "‚úÖ" : "‚¨ú"; }
        return [
`Step 1 ‚Äî Vehicle Projection Limit
  ${line(data["s1.captureDims"])} Dimensions captured
  ${line(data["s1.compareProj"])} Projection vs envelope compared
  ${line(data["s1.margins"])} Clearance margins documented
  ${line(data["s1.photos"])} Reference diagrams/photos attached
  Notes: ${data["s1.notes"]||""}

Step 2 ‚Äî Ramp Toe Contact Limit
  ${line(data["s2.approachAngle"])} Approach geometry evaluated
  ${line(data["s2.contactCheck"])} Ramp toe contact checked
  ${line(data["s2.shoring"])} Approach shoring considered/applied
  ${line(data["s2.docs"])} Calculations/assumptions documented
  Notes: ${data["s2.notes"]||""}

Step 3 ‚Äî Ground Contact Limit
  ${line(data["s3.clearance"])} Undercarriage/overhang clearances
  ${line(data["s3.path"])} Path/transition checked
  ${line(data["s3.sleeper"])} Sleeper/parking shoring planned
  ${line(data["s3.docs"])} Findings documented
  Notes: ${data["s3.notes"]||""}

Step 4 ‚Äî Ramp Crest Limit
  ${line(data["s4.geom"])} Crest vs vehicle breakover checked
  ${line(data["s4.contact"])} Crest contact assessed
  ${line(data["s4.mitigation"])} Mitigation identified
  ${line(data["s4.docs"])} Calculation rationale documented
  Notes: ${data["s4.notes"]||""}

Step 5 ‚Äî Parking Overhang Limit
  ${line(data["s5.overhang"])} Overhang vs obstacles verified
  ${line(data["s5.egress"])} Egress/aisles maintained
  ${line(data["s5.secure"])} Parking secure (shoring/restraint ready)
  ${line(data["s5.docs"])} Parking configuration documented
  Notes: ${data["s5.notes"]||""}
`
        ].join("\n");
      }

      function generate() {
        document.getElementById("summary").textContent = summaryText();
      }

      if (hasLP && typeof LP.initPage === "function") {
        LP.initPage(function() { save(); updateStatus(); });
      } else {
        document.querySelectorAll("input, select, textarea").forEach((el) => {
          el.addEventListener("input", function(){ save(); updateStatus(); });
          el.addEventListener("change", function(){ save(); updateStatus(); });
        });
      }

      apply(load());
      updateStatus();

      document.getElementById("btn-generate").addEventListener("click", generate);
      document.getElementById("btn-export").addEventListener("click", function(){
        const data = collect();
        const blob = new Blob([JSON.stringify({ exportedAt: new Date().toISOString(), data }, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "loadability5_ops_export.json";
        a.click();
        URL.revokeObjectURL(url);
      });
      document.getElementById("btn-reset").addEventListener("click", reset);
    })();
  </script>
</body>
</html>
