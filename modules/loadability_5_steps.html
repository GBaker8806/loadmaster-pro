<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5 Steps of Loadability</title>
  <link rel="stylesheet" href="../style.css" />
  <script src="../common.js" defer></script>
  <style>
    /* Minimal enhancements that should coexist with your style.css */
    .container { max-width: 1100px; margin: 0 auto; padding: 1rem; }
    .grid { display: grid; gap: 1rem; }
    .grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .card { border: 1px solid #333; border-radius: 12px; padding: 1rem; background: #0e0e0e; }
    .card h2 { margin: 0 0 .5rem 0; }
    .muted { opacity: .85; font-size: .95rem; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: .5rem; }
    .btn { padding: .5rem .9rem; border-radius: 8px; border: 1px solid #444; cursor: pointer; background: #1a1a1a; }
    .btn:active { transform: translateY(1px); }
    .btn-primary { border-color: #3d8bfd; }
    .btn-danger { border-color: #cc3344; }
    .pill { padding: .25rem .5rem; border: 1px solid #444; border-radius: 999px; font-size: .8rem; }
    .progress { height: 10px; background: #222; border-radius: 999px; overflow: hidden; }
    .progress > div { height: 100%; background: #3d8bfd; width: 0; }
    .step-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem; }
    details summary { cursor: pointer; font-weight: 600; }
    textarea { width: 100%; min-height: 72px; background: #121212; color: #fff; border: 1px solid #333; border-radius: 8px; padding: .5rem; }
    label { display: flex; align-items: center; gap: .5rem; margin: .25rem 0; }
    .summary-box { white-space: pre-wrap; border: 1px dashed #444; padding: .75rem; border-radius: 8px; background: #121212; }
  </style>
</head>
<body>
  <button onclick="goHome()" class="home-button">üè† Home</button>
  <div class="container">
    <h1>5 Steps of Loadability</h1>
    <p class="muted">Use this checklist to walk through each step, capture notes, and export a summary for your load plan package.</p>

    <div class="row" style="margin: 1rem 0;">
      <div class="pill" id="progress-label">0/5 complete</div>
      <div class="progress" style="flex:1;">
        <div id="progress-bar"></div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="step-header">
          <h2>Step 1 ‚Äî Cargo Data</h2>
          <span class="pill" id="s1-status">Incomplete</span>
        </div>
        <details open>
          <summary>Dimensions, weight, axle data, and hazardous classification (if any)</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s1.dimensions" /> Dimensions verified (L√óW√óH)</label>
            <label><input type="checkbox" data-key="s1.weight" /> Weight confirmed (gross & per-axle)</label>
            <label><input type="checkbox" data-key="s1.axles" /> Axle/tire configuration captured</label>
            <label><input type="checkbox" data-key="s1.hazmat" /> HAZMAT / special handling identified</label>
            <label><input type="checkbox" data-key="s1.documentation" /> Docs/photos attached (as required)</label>
            <label>Notes:</label>
            <textarea data-key="s1.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>

      <div class="card">
        <div class="step-header">
          <h2>Step 2 ‚Äî Compatibility & Clearance</h2>
          <span class="pill" id="s2-status">Incomplete</span>
        </div>
        <details>
          <summary>Door/ramp, height/width, aisle, and obstacle clearances</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s2.rampDoor" /> Ramp/door clearances met</label>
            <label><input type="checkbox" data-key="s2.heightWidth" /> Height/width within limits</label>
            <label><input type="checkbox" data-key="s2.aisle" /> Aisle/egress maintained (as applicable)</label>
            <label><input type="checkbox" data-key="s2.obstacles" /> Avoids obstacles (rails, rollers, etc.)</label>
            <label><input type="checkbox" data-key="s2.palletVehicle" /> Pallet/vehicle interface checked</label>
            <label>Notes:</label>
            <textarea data-key="s2.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>

      <div class="card">
        <div class="step-header">
          <h2>Step 3 ‚Äî Shoring</h2>
          <span class="pill" id="s3-status">Incomplete</span>
        </div>
        <details>
          <summary>Sleeper, approach, and parking shoring as required</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s3.need" /> Shoring required assessment complete</label>
            <label><input type="checkbox" data-key="s3.sleeper" /> Sleeper shoring sized & placed</label>
            <label><input type="checkbox" data-key="s3.approach" /> Approach shoring computed</label>
            <label><input type="checkbox" data-key="s3.parking" /> Parking shoring computed</label>
            <label><input type="checkbox" data-key="s3.docs" /> Shoring plan documented</label>
            <label>Notes:</label>
            <textarea data-key="s3.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>

      <div class="card">
        <div class="step-header">
          <h2>Step 4 ‚Äî Restraint</h2>
          <span class="pill" id="s4-status">Incomplete</span>
        </div>
        <details>
          <summary>Fore/aft/lateral/vertical restraint, devices, and angles</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s4.calc" /> Required restraint calculated (F/A/L/V)</label>
            <label><input type="checkbox" data-key="s4.devices" /> Devices selected (5K/10K/25K) & angles</label>
            <label><input type="checkbox" data-key="s4.attach" /> Attach points verified</label>
            <label><input type="checkbox" data-key="s4.sketch" /> Restraint diagram/sketch created</label>
            <label><input type="checkbox" data-key="s4.docs" /> Restraint plan documented</label>
            <label>Notes:</label>
            <textarea data-key="s4.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>

      <div class="card">
        <div class="step-header">
          <h2>Step 5 ‚Äî Weight & Balance / CG</h2>
          <span class="pill" id="s5-status">Incomplete</span>
        </div>
        <details>
          <summary>Moments, CG, load shift checks, ACL impacts</summary>
          <div style="margin-top:.5rem;">
            <label><input type="checkbox" data-key="s5.cg" /> Item moments & CG verified</label>
            <label><input type="checkbox" data-key="s5.shift" /> Load shift assessed (if applicable)</label>
            <label><input type="checkbox" data-key="s5.acl" /> ACL impact reviewed</label>
            <label><input type="checkbox" data-key="s5.signoff" /> Final review/sign-off</label>
            <label>Notes:</label>
            <textarea data-key="s5.notes" placeholder="Add details..."></textarea>
          </div>
        </details>
      </div>
    </div>

    <div class="card" style="margin-top:1rem;">
      <div class="row">
        <h2>Summary</h2>
        <div class="row" style="gap:.5rem;">
          <button class="btn btn-primary" id="btn-generate">Generate Summary</button>
          <button class="btn" id="btn-export">Export JSON</button>
          <button class="btn" onclick="window.print()">Print</button>
          <button class="btn btn-danger" id="btn-reset">Reset</button>
        </div>
      </div>
      <div id="summary" class="summary-box" style="margin-top:.5rem;"></div>
    </div>
  </div>

  <script>
    (function(){
      const KEY = "lp_loadability5";
      const hasLP = typeof window.LP !== "undefined";
      const saveJSON = hasLP && LP.saveJSON ? (k,v)=>LP.saveJSON(k,v) : (k,v)=>{ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} };
      const loadJSON = hasLP && LP.loadJSON ? (k,f)=>LP.loadJSON(k,f) : (k,f)=>{ try{ const raw=localStorage.getItem(k); return raw?JSON.parse(raw):f; }catch(e){ return f; } };
    

      function collect() {
        const inputs = document.querySelectorAll("[data-key]");
        const data = {};
        inputs.forEach(el => {
          const key = el.getAttribute("data-key");
          if (el.type === "checkbox") data[key] = !!el.checked;
          else data[key] = el.value || "";
        });
        return data;
      }

      function apply(data) {
        const inputs = document.querySelectorAll("[data-key]");
        inputs.forEach(el => {
          const key = el.getAttribute("data-key");
          if (!(key in data)) return;
          if (el.type === "checkbox") el.checked = !!data[key];
          else el.value = data[key];
        });
      }

      function save() { saveJSON(KEY, collect()); }
      function load() { return loadJSON(KEY, {}); }
      function reset() {
        localStorage.removeItem(KEY);
        document.querySelectorAll("[data-key]").forEach(el => {
          if (el.type === "checkbox") el.checked = false;
          else el.value = "";
        });
        updateStatus();
        document.getElementById("summary").textContent = "";
      }

      function stepComplete(prefix) {
        const data = collect();
        const keys = Object.keys(data).filter(k => k.startsWith(prefix));
        if (keys.length === 0) return false;
        // Complete if at least one checkbox is checked OR there are notes
        const anyChecked = keys.some(k => k.endsWith(".notes") ? false : data[k] === true);
        const hasNotes = !!data[`${prefix}.notes`];
        return anyChecked || hasNotes;
      }

      function updateStatus() {
        const steps = [1,2,3,4,5];
        let done = 0;
        steps.forEach(n => {
          const ok = stepComplete("s"+n);
          const pill = document.getElementById(`s${n}-status`);
          if (pill) pill.textContent = ok ? "Complete" : "Incomplete";
          if (pill) pill.style.borderColor = ok ? "#2aa84a" : "#444";
          if (ok) done++;
        });
        const pct = (done/steps.length)*100;
        document.getElementById("progress-label").textContent = `${done}/5 complete`;
        document.getElementById("progress-bar").style.width = `${pct}%`;
      }

      function summaryText() {
        const data = collect();
        function line(ok){ return ok ? "‚úÖ" : "‚¨ú"; }
        return [
`Step 1 ‚Äî Cargo Data
  ${line(data["s1.dimensions"])} Dimensions verified
  ${line(data["s1.weight"])} Weight confirmed
  ${line(data["s1.axles"])} Axle/tire configuration captured
  ${line(data["s1.hazmat"])} HAZMAT identified
  ${line(data["s1.documentation"])} Docs attached
  Notes: ${data["s1.notes"]||""}

Step 2 ‚Äî Compatibility & Clearance
  ${line(data["s2.rampDoor"])} Ramp/door clearances met
  ${line(data["s2.heightWidth"])} Height/width within limits
  ${line(data["s2.aisle"])} Aisle/egress maintained
  ${line(data["s2.obstacles"])} Avoids obstacles
  ${line(data["s2.palletVehicle"])} Pallet/vehicle interface
  Notes: ${data["s2.notes"]||""}

Step 3 ‚Äî Shoring
  ${line(data["s3.need"])} Shoring required assessment
  ${line(data["s3.sleeper"])} Sleeper shoring
  ${line(data["s3.approach"])} Approach shoring
  ${line(data["s3.parking"])} Parking shoring
  ${line(data["s3.docs"])} Shoring plan documented
  Notes: ${data["s3.notes"]||""}

Step 4 ‚Äî Restraint
  ${line(data["s4.calc"])} Required restraint calculated
  ${line(data["s4.devices"])} Devices & angles selected
  ${line(data["s4.attach"])} Attach points verified
  ${line(data["s4.sketch"])} Diagram/sketch created
  ${line(data["s4.docs"])} Restraint plan documented
  Notes: ${data["s4.notes"]||""}

Step 5 ‚Äî Weight & Balance / CG
  ${line(data["s5.cg"])} Item moments & CG verified
  ${line(data["s5.shift"])} Load shift assessed
  ${line(data["s5.acl"])} ACL impact reviewed
  ${line(data["s5.signoff"])} Final review/sign-off
  Notes: ${data["s5.notes"]||""}
`
        ].join("\n");
      }

      function generate() {
        document.getElementById("summary").textContent = summaryText();
      }

      // Wire inputs
      if (hasLP && typeof LP.initPage === "function") {
        LP.initPage(function() { save(); updateStatus(); });
      } else {
        // Fallback: manually wire inputs
        document.querySelectorAll("input, select, textarea").forEach((el) => {
          el.addEventListener("input", function(){ save(); updateStatus(); });
          el.addEventListener("change", function(){ save(); updateStatus(); });
        });
      }

      // Init with saved data
      apply(load());
      updateStatus();

      // Buttons
      document.getElementById("btn-generate").addEventListener("click", generate);
      document.getElementById("btn-export").addEventListener("click", function(){
        const data = collect();
        const blob = new Blob([JSON.stringify({ exportedAt: new Date().toISOString(), data }, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "loadability5_export.json";
        a.click();
        URL.revokeObjectURL(url);
      });
      document.getElementById("btn-reset").addEventListener("click", reset);
    })();
  </script>
</body>
</html>
