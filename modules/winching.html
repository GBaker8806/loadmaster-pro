<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Winching Calculator</title>
  <style>
    :root {
      --highlight-color: #3e8eaa;
      --bg-color: #121212;
      --primary-color: #1f6f8b;
      --accent-color: #99e1d9;
      --text-color: #e0e0e0;
      --card-color: #1e1e1e;
      --danger: #ff5c5c;
      --ok: #66d17a;
      --warn: #ffd166;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 1rem;
    }
    select, input, button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      border-radius: 8px;
      border: 1px solid #444;
      font-size: 1rem;
      background-color: #2a2a2a;
      color: var(--text-color);
      box-sizing: border-box;
    }
    label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.25rem;
      font-weight: 500;
    }
    button {
      background-color: var(--primary-color);
      color: #fff;
      font-weight: bold;
      transition: background-color 0.3s ease;
      cursor: pointer;
    }
    button:hover { background-color: var(--highlight-color); }

    #winchResult {
      margin-top: 1rem;
      padding: 1rem;
      background-color: var(--card-color);
      border-left: 4px solid var(--primary-color);
      border-radius: 8px;
      white-space: pre-line;
      font-weight: bold;
    }
    .tag { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 6px; font-weight: 700; }
    .pass { background: var(--ok); color: #032b11; }
    .fail { background: var(--danger); color: white; }
    .note { color: #ddd; font-weight: normal; }
  </style>
</head>
<body>
  <h2>Winching Calculator</h2>

  <label for="winchWeight">Cargo Weight (lbs):</label>
  <input type="text" inputmode="numeric" pattern="[0-9]*" id="winchWeight" placeholder="e.g., 22000" />

  <label for="winchRamp">Ramp Angle:</label>
  <select id="winchRamp">
    <option value="0">Level Ramp (0°)</option>
    <option value="3.8">Long ADS with Plugs (3.8°)</option>
    <option value="5">Long ADS Only (5°)</option>
    <option value="15">Normal Ramp / Toes Down (15°)</option>
  </select>

  <label for="winchSurface">Surface Type:</label>
  <select id="winchSurface">
    <option value="pneumatic">Pneumatic Tires</option>
    <option value="tracks">Tracks</option>
    <option value="steel">Steel/Hard Rubber Wheels</option>
    <option value="roller">Roller Conveyors</option>
    <option value="greased">Greased Shoring</option>
    <option value="dry">Dry Shoring</option>
    <option value="skids">Skids on Non-Skid</option>
    <option value="nonskid">Non-Skid Surface</option>
  </select>

  <button onclick="calculateWinching()">Calculate Required Snatch Blocks</button>
  <div id="winchResult"></div>

  <script>
    function calculateWinching() {
      const weight = parseFloat(document.getElementById("winchWeight").value);
      const angle = document.getElementById("winchRamp").value; // keep as string to map
      const surface = document.getElementById("winchSurface").value;

      const out = document.getElementById("winchResult");

      if (isNaN(weight) || weight <= 0) {
        out.innerText = "Please enter a valid cargo weight.";
        return;
      }

      // Max single-line capacities by surface and ramp angle index:
      // [0° , 3.8° , 5° , 15°]
      const maxWeights = {
        pneumatic: [250000, 60038, 49281, 20000],
        tracks:    [ 93750, 51426, 44996, 22303],
        steel:     [416667, 58358, 46699, 17729],
        roller:    [375000, 87250, 70146, 26947],
        greased:   [ 28846, 23043, 21679, 14701],
        dry:       [ 15306, 13513, 13043, 10241],
        skids:     [  9202,  8529,  8345,  7168],
        nonskid:   [  7500,  7049,  6925,  6122]
      };

      const rampIndexMap = { "0": 0, "3.8": 1, "5": 2, "15": 3 };

      if (!(surface in maxWeights) || !(angle in rampIndexMap)) {
        out.innerText = "Invalid selection. Please recheck surface and ramp angle.";
        return;
      }

      const idx = rampIndexMap[angle];
      const singleLineCap = maxWeights[surface][idx];     // capacity for a single line
      const maxLines = 5;                                 // quintuple line (4 snatch blocks)
      const maxSnatchBlocks = 4;

      // Required lines (ceil)
      const requiredLines = Math.ceil(weight / singleLineCap);

      // Clamp display lines (can't exceed 5)
      const displayLines = Math.min(requiredLines, maxLines);
      const displaySnatch = Math.min(Math.max(displayLines - 1, 0), maxSnatchBlocks);

      // Max allowable with quintuple line
      const maxAllowable = singleLineCap * maxLines;

      const surfaceText = document.getElementById("winchSurface").selectedOptions[0].text;
      const rampText = document.getElementById("winchRamp").selectedOptions[0].text;

      // PASS/FAIL & margin
      const withinCapability = weight <= maxAllowable;
      const margin = withinCapability ? (maxAllowable - weight) : (weight - maxAllowable);

      const statusTag = withinCapability
        ? `<span class="tag pass">LOADABLE</span>`
        : `<span class="tag fail">EXCEEDS LIMITS</span>`;

      const marginLine = withinCapability
        ? `Margin under max: ${margin.toLocaleString()} lbs`
        : `EXCEEDS MAX by: ${margin.toLocaleString()} lbs`;

      // Build output
      let text = "";
      text += `${statusTag}\n`;
      text += `Surface: ${surfaceText}\n`;
      text += `Ramp: ${rampText}\n`;
      text += `Max Single Line Capacity: ${singleLineCap.toLocaleString()} lbs\n`;
      text += `Required Lines: ${requiredLines}  (Displays up to ${maxLines}-line config)\n`;
      text += `Recommended Configuration: ${displayLines}-line winch  |  Snatch Blocks: ${displaySnatch}\n`;
      text += `Maximum Allowable Cargo (with ${maxLines}-line): ${maxAllowable.toLocaleString()} lbs\n`;
      text += `${marginLine}\n`;

      if (!withinCapability) {
        text += `\n⚠️ Selected surface/ramp combination exceeds winch capability even with ${maxLines}-line.`;
      }

      text += `\n\n<span class="note">

      out.innerHTML = text;
    }
  </script>
</body>
</html>